---
import Layout from "../../../layouts/Layout.astro";
import Header from "../../../components/Header.astro";
import Footer from "../../../components/Footer.astro";
import SectionTitle from "../../../components/SectionTitle.astro";
import { languages } from "../../../i18n/ui";
import { getLangFromUrl, useTranslations } from "../../../i18n/utils";
import Button from "../../../components/Button.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
const posts = (await getCollection("blog")).filter((p: any) =>
  p.slug.startsWith(Astro.params.lang),
);

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const constructDate = (dateString: string): string => {
  const date = new Date(dateString);
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
  return date.toLocaleDateString(lang, options);
}

export const getStaticPaths = (() => {
  let paths = [];

  for (const key of Object.keys(languages)) {
    paths.push({ params: { lang: key } });
  }
  return paths;
}) satisfies GetStaticPaths;
---

<Layout title="Blog">
  <div class="min-h-lvh">
    <Header />
    <div class="container m-auto">
      <SectionTitle>{t('blog.title')}</SectionTitle>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 mt-5 gap-15">
        {
          posts.map((post) => (
            <div class="block border-2 border-primary rounded-2xl p-6">
              <h3 class="text-2xl">{post.data.title}</h3>
              <h5 class="text-secondary">{constructDate(post.data.date)}</h5>
              <img src={post.data.coverImg} alt={post.data.altImg} class="my-2 rounded-2xl aspect-video w-max object-cover">
              <p class="font-mono">{post.data.description}</p>
              <div class="grid mt-4 font-mono grid-cols-3 gap-2">
                <ul class="flex gap-2 text-secondary flex-wrap col-span-2">
                  {post.data.tags?.map((tag) => (
                    <li>{tag}</li>
                  ))}
                </ul>
                <div class="flex justify-center">
                  <Button
                    href={`/${lang}/blog/${post.slug.split("/")[1]}`}
                    icon="mingcute:link-line"
                    target="_self"
                  />
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
  <Footer />
</Layout>
